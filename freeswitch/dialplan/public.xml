<?xml version="1.0" encoding="utf-8"?>
<!--
    Public Context for Inbound Calls
    Handles calls from external SIP trunks
-->
<include>
  <context name="public">

    <!-- Admin Panel generated inbound routes (must come before catch-alls) -->
    <X-PRE-PROCESS cmd="include" data="public/*.xml"/>

    <!-- Outbound calls from external context -->
    <extension name="External_Outbound_Calls">
      <condition field="destination_number" expression="^(\+?[1-9][0-9]{7,14})$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="ringback=${adminpanel_outgoing_sound:-${adminpanel_trunk_outgoing_sound:-${us-ring}}}"/>
        <action application="lua" data="adminpanel_outgoing_ivr.lua"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/$1"/>
      </condition>
    </extension>

  </context>
</include>