<?xml version="1.0" encoding="utf-8"?>
<!--
    AI Voice Dialplan
    Routes calls to backend AudioSocket service for AI processing
-->
<include>
    <context name="ai-voice">

        <!-- Route to AI Voice Service -->
        <extension name="AI_Voice_Service">
            <condition field="destination_number" expression="^(ai|voice|assistant)$">
                <action application="answer"/>
                <action application="sleep" data="500"/>
                <action application="set" data="STREAM_SUPPRESS_LOG=true"/>
                <!-- Start WebSocket audio stream to backend (mod_audio_stream) -->
                <action application="lua" data="/usr/local/freeswitch/etc/freeswitch/scripts/start_audio_stream.lua $${audio_stream_url} mono 16k"/>
                <action application="sleep" data="3600000"/>
                <action application="hangup"/>
            </condition>
        </extension>

        <!-- Route all calls to AI by default (for testing) -->
        <extension name="AI_Default">
            <condition>
                <action application="answer"/>
                <action application="sleep" data="500"/>
                <action application="set" data="STREAM_SUPPRESS_LOG=true"/>
                <action application="lua" data="/usr/local/freeswitch/etc/freeswitch/scripts/start_audio_stream.lua $${audio_stream_url} mono 16k"/>
                <action application="sleep" data="3600000"/>
                <action application="hangup"/>
            </condition>
        </extension>

    </context>
</include>

