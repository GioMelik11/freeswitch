<?xml version="1.0" encoding="utf-8"?>
<!--
    DTMF-based Transfer Manual Keypad Configuration
    FreeSWITCH 1.18
    
    This configuration provides DTMF-based transfer functionality:
    - ## : Blind Transfer (dial extension to transfer to)
    - *2 : Attended Transfer (consult then transfer)
    - *3 : Conference Transfer (transfer both legs to conference)
    - *4 : Hold with Music
    - *5 : Return to Operator
    - *6 : Call Park
    - *7 : Call Pickup
    - *8 : Voicemail Access
    - *9 : Help Menu
    
    Usage: During an active call, press the DTMF sequence to activate the feature.
-->
<include>
    <context name="default">

        <!-- Enhanced DTMF Transfer Bindings with better error handling -->
        <extension name="dtmf_transfer_enhanced" continue="true">
            <condition field="${call_direction}" expression="^(inbound|outbound)$">
                <!-- ## - Blind Transfer with confirmation -->
                <action application="bind_digit_action" data="blind_transfer,##,exec:transfer,dtmf_blind_transfer XML features"/>

                <!-- *2 - Attended Transfer with consultation -->
                <action application="bind_digit_action" data="attended_transfer,*2,exec:transfer,dtmf_attended_transfer XML features"/>

                <!-- *3 - Conference Transfer -->
                <action application="bind_digit_action" data="conference_transfer,*3,exec:transfer,dtmf_conference_transfer XML features"/>

                <!-- *4 - Hold with Music -->
                <action application="bind_digit_action" data="hold_music,*4,exec:transfer,dtmf_hold XML features"/>

                <!-- *5 - Operator Transfer -->
                <action application="bind_digit_action" data="operator_transfer,*5,exec:transfer,dtmf_operator XML features"/>

                <!-- *6 - Call Park -->
                <action application="bind_digit_action" data="call_park,*6,exec:transfer,dtmf_park XML features"/>

                <!-- *7 - Call Pickup -->
                <action application="bind_digit_action" data="call_pickup,*7,exec:transfer,dtmf_pickup XML features"/>

                <!-- *8 - Voicemail -->
                <action application="bind_digit_action" data="voicemail_access,*8,exec:transfer,dtmf_voicemail XML features"/>

                <!-- *9 - Help Menu -->
                <action application="bind_digit_action" data="help_menu,*9,exec:transfer,dtmf_help XML features"/>

                <!-- *# - Cancel any pending DTMF action -->
                <action application="bind_digit_action" data="cancel,*#,exec:hangup,NORMAL_CLEARING"/>
            </condition>
        </extension>

        <!-- Quick Transfer Extensions for immediate use -->
        <extension name="quick_transfer_1000">
            <condition field="destination_number" expression="^dtmf_quick_1000$">
                <action application="transfer" data="1000 XML default"/>
            </condition>
        </extension>

        <extension name="quick_transfer_1001">
            <condition field="destination_number" expression="^dtmf_quick_1001$">
                <action application="transfer" data="1001 XML default"/>
            </condition>
        </extension>

        <extension name="quick_transfer_operator">
            <condition field="destination_number" expression="^dtmf_quick_operator$">
                <action application="transfer" data="1000 XML features"/>
            </condition>
        </extension>

    </context>
</include>
