<?xml version="1.0" encoding="utf-8"?>
<!--
    Clean Dialplan Configuration
    Supports:
    - Local extensions (1000-1099)
    - Outbound calls (9 + number)
    - Inbound calls from trunks
    - IVR access (5000)
    - Queue access (2000-2009)
    - Voicemail access (*98)
-->
<include>
  <context name="default">

    <!-- Loop prevention -->
    <extension name="unloop">
      <condition field="${unroll_loops}" expression="^true$"/>
      <condition field="${sip_looped_call}" expression="^true$">
        <action application="deflect" data="${destination_number}"/>
      </condition>
    </extension>

    <!-- Global settings -->
    <extension name="global" continue="true">
      <condition field="${call_debug}" expression="^true$" break="never">
        <action application="info"/>
      </condition>

      <condition>
        <action application="hash" data="insert/${domain_name}-last_dial/${caller_id_number}/${destination_number}"/>
        <action application="export" data="RFC2822_DATE=${strftime(%a, %d %b %Y %T %z)}"/>
      </condition>
    </extension>

    <!-- Local Extensions (1000-1099) -->
    <extension name="Local_Extension">
      <condition field="destination_number" expression="^(10[0-9][0-9])$">
        <action application="export" data="dialed_extension=$1"/>
        <action application="set" data="ringback=${us-ring}"/>
        <action application="set" data="transfer_ringback=$${hold_music}"/>
        <action application="set" data="call_timeout=30"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="hash" data="insert/${domain_name}-call_return/${dialed_extension}/${caller_id_number}"/>
        <action application="bridge" data="user/${dialed_extension}@${domain_name}"/>
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="hangup" data="NO_ANSWER"/>
      </condition>
    </extension>

    <!-- Active Extensions (1001, 1003) - Fixed media bridging with recording -->
    <extension name="Active_Extensions">
      <condition field="destination_number" expression="^(100[13])$">
        <action application="set" data="dialed_extension=$1"/>
        <action application="set" data="ringback=${us-ring}"/>
        <action application="set" data="call_timeout=30"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="bypass_media=false"/>
        <action application="set" data="proxy_media=false"/>
        <action application="set" data="media_mix_inbound_outbound_codecs=false"/>
        <action application="set" data="rtp_secure_media=false"/>

        <!-- Auto-recording for active extensions -->
        <action application="set" data="recording_path=/usr/share/freeswitch/sounds/recordings/${strftime(%Y/%m/%d)}/${uniqueid}.mp3"/>
        <action application="record_session" data="${recording_path}"/>

        <action application="bridge" data="user/${dialed_extension}@${domain_name}"/>
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="hangup" data="NO_ANSWER"/>
      </condition>
    </extension>

    <!-- Inactive Extensions (1000, 1002, 1004, 1005) - Loopback fallback -->
    <extension name="Inactive_Extensions">
      <condition field="destination_number" expression="^(100[0245])$">
        <action application="set" data="dialed_extension=$1"/>
        <action application="set" data="ringback=${us-ring}"/>
        <action application="set" data="call_timeout=30"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="loopback/$1/default"/>
      </condition>
    </extension>

    <!-- Simple Extension Bridge - Alternative routing method -->
    <extension name="Simple_Extension_Bridge">
      <condition field="destination_number" expression="^(100[0-5])$">
        <action application="set" data="call_timeout=30"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="bridge" data="user/$1@${domain_name}"/>
      </condition>
    </extension>

    <!-- Outbound Calls (9 + number) - Enhanced for SIP trunk -->
    <extension name="Outbound_Calls">
      <condition field="destination_number" expression="^9(.*)$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="selected_trunk=${default_trunk}"/>
        <action application="bridge" data="sofia/gateway/${selected_trunk}/$1"/>
      </condition>
    </extension>

    <!-- Trunk Selection Feature Codes -->
    <!-- Use Primary Trunk - *91 + number -->
    <extension name="Primary_Trunk_Call">
      <condition field="destination_number" expression="^\*91(.*)$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="selected_trunk=${default_trunk}"/>
        <action application="bridge" data="sofia/gateway/${selected_trunk}/$1"/>
      </condition>
    </extension>

    <!-- Use Backup Trunk - *92 + number -->
    <extension name="Backup_Trunk_Call">
      <condition field="destination_number" expression="^\*92(.*)$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="selected_trunk=${backup_trunk}"/>
        <action application="bridge" data="sofia/gateway/${selected_trunk}/$1"/>
      </condition>
    </extension>

    <!-- Use International Trunk - *93 + number -->
    <extension name="International_Trunk_Call">
      <condition field="destination_number" expression="^\*93(.*)$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="selected_trunk=${international_trunk}"/>
        <action application="bridge" data="sofia/gateway/${selected_trunk}/$1"/>
      </condition>
    </extension>

    <!-- Use Local Trunk - *94 + number -->
    <extension name="Local_Trunk_Call">
      <condition field="destination_number" expression="^\*94(.*)$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="set" data="selected_trunk=${local_trunk}"/>
        <action application="bridge" data="sofia/gateway/${selected_trunk}/$1"/>
      </condition>
    </extension>

    <!-- Direct Outbound Calls (without 9 prefix) -->
    <extension name="Direct_Outbound_Calls">
      <condition field="destination_number" expression="^(\+?[1-9][0-9]{7,14})$">
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/$1"/>
      </condition>
    </extension>

    <!-- IVR Access -->
    <extension name="IVR_Main">
      <condition field="destination_number" expression="^5000$">
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="ivr" data="main_ivr"/>
      </condition>
    </extension>

    <!-- Queue Access with Recording -->
    <extension name="Queue_1">
      <condition field="destination_number" expression="^2000$">
        <action application="answer"/>

        <!-- Auto-recording for queue calls -->
        <action application="set" data="recording_path=/usr/share/freeswitch/sounds/recordings/${strftime(%Y/%m/%d)}/${uniqueid}.mp3"/>
        <action application="record_session" data="${recording_path}"/>

        <action application="callcenter" data="queue1@default"/>
      </condition>
    </extension>

    <extension name="Queue_2">
      <condition field="destination_number" expression="^2001$">
        <action application="answer"/>

        <!-- Auto-recording for queue calls -->
        <action application="set" data="recording_path=/usr/share/freeswitch/sounds/recordings/${strftime(%Y/%m/%d)}/${uniqueid}.mp3"/>
        <action application="record_session" data="${recording_path}"/>

        <action application="callcenter" data="queue2@default"/>
      </condition>
    </extension>

    <!-- Specific Queue Numbers -->
    <extension name="Queue_251144">
      <condition field="destination_number" expression="^251144$">
        <action application="answer"/>
        <action application="callcenter" data="queue1@default"/>
      </condition>
    </extension>

    <extension name="Queue_255431">
      <condition field="destination_number" expression="^255431$">
        <action application="answer"/>
        <action application="callcenter" data="queue2@default"/>
      </condition>
    </extension>

    <!-- Voicemail Access - DISABLED -->
    <!--
    <extension name="Voicemail_Main">
      <condition field="destination_number" expression="^\*98$">
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="voicemail" data="check default ${domain_name}"/>
      </condition>
    </extension>
    -->

    <!-- Operator -->
    <extension name="Operator">
      <condition field="destination_number" expression="^(operator|0)$">
        <action application="set" data="transfer_ringback=$${hold_music}"/>
        <action application="transfer" data="1000 XML features"/>
      </condition>
    </extension>

    <!-- Conference Rooms (3000-3099) -->
    <extension name="Conference_Rooms">
      <condition field="destination_number" expression="^(30[0-9][0-9])$">
        <action application="answer"/>
        <action application="conference" data="$1-${domain_name}@default"/>
      </condition>
    </extension>

    <!-- Loopback Extension Handler for Inactive Extensions -->
    <extension name="Loopback_Extension_Handler">
      <condition field="destination_number" expression="^(100[0245])$">
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="playback" data="ivr/ivr-welcome_to_freeswitch.wav"/>
        <action application="sleep" data="2000"/>
        <action application="playback" data="ivr/ivr-you_are_now_connected.wav"/>
        <action application="sleep" data="2000"/>
        <action application="hangup" data="NORMAL_CLEARING"/>
      </condition>
    </extension>

    <extension name="Hold_Music">
      <condition field="destination_number" expression="^9664$">
        <action application="answer"/>
        <action application="playback" data="$${hold_music}"/>
      </condition>
    </extension>

    <!-- Transfer Features -->
    <!-- Blind Transfer - *1 + extension -->
    <extension name="Blind_Transfer_Internal">
      <condition field="destination_number" expression="^\*1(10[0-9][0-9])$">
        <action application="set" data="transfer_destination=$1"/>
        <action application="playback" data="ivr/ivr-transferring_call.wav"/>
        <action application="transfer" data="${transfer_destination} XML default"/>
      </condition>
    </extension>

    <!-- Blind Transfer - *2 + external number -->
    <extension name="Blind_Transfer_External">
      <condition field="destination_number" expression="^\*2(.*)$">
        <action application="set" data="transfer_destination=$1"/>
        <action application="playback" data="ivr/ivr-transferring_call.wav"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/${transfer_destination}"/>
      </condition>
    </extension>

    <!-- Attended Transfer - *3 + extension (consult then transfer) -->
    <extension name="Attended_Transfer_Internal">
      <condition field="destination_number" expression="^\*3(10[0-9][0-9])$">
        <action application="set" data="transfer_destination=$1"/>
        <action application="playback" data="ivr/ivr-please_hold_while_connect.wav"/>
        <action application="set" data="attended_transfer=true"/>
        <action application="bridge" data="user/${transfer_destination}@${domain_name}"/>
      </condition>
    </extension>

    <!-- Attended Transfer - *4 + external number (consult then transfer) -->
    <extension name="Attended_Transfer_External">
      <condition field="destination_number" expression="^\*4(.*)$">
        <action application="set" data="transfer_destination=$1"/>
        <action application="playback" data="ivr/ivr-please_hold_while_connect.wav"/>
        <action application="set" data="attended_transfer=true"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/${transfer_destination}"/>
      </condition>
    </extension>

    <!-- Complete Attended Transfer - *5 -->
    <extension name="Complete_Attended_Transfer">
      <condition field="destination_number" expression="^\*5$">
        <action application="playback" data="ivr/ivr-transfer_complete.wav"/>
        <action application="att_xfer" data=""/>
      </condition>
    </extension>

    <!-- Cancel Attended Transfer - *6 -->
    <extension name="Cancel_Attended_Transfer">
      <condition field="destination_number" expression="^\*6$">
        <action application="playback" data="ivr/ivr-transfer_cancelled.wav"/>
        <action application="hangup" data="NORMAL_CLEARING"/>
      </condition>
    </extension>

    <!-- Monitor Features -->
    <!-- Start Monitor - *7 + extension -->
    <extension name="Start_Monitor">
      <condition field="destination_number" expression="^\*7(10[0-9][0-9])$">
        <action application="set" data="monitor_extension=$1"/>
        <action application="playback" data="ivr/ivr-monitor_started.wav"/>
        <action application="uuid_broadcast" data="${monitor_extension} eavesdrop"/>
      </condition>
    </extension>

    <!-- Stop Monitor - *8 -->
    <extension name="Stop_Monitor">
      <condition field="destination_number" expression="^\*8$">
        <action application="playback" data="ivr/ivr-monitor_stopped.wav"/>
        <action application="uuid_break" data=""/>
      </condition>
    </extension>

    <!-- Start Whisper - *9 + extension -->
    <extension name="Start_Whisper">
      <condition field="destination_number" expression="^\*9(10[0-9][0-9])$">
        <action application="set" data="whisper_extension=$1"/>
        <action application="playback" data="ivr/ivr-whisper_started.wav"/>
        <action application="uuid_broadcast" data="${whisper_extension} whisper"/>
      </condition>
    </extension>

    <!-- Stop Whisper - *0 -->
    <extension name="Stop_Whisper">
      <condition field="destination_number" expression="^\*0$">
        <action application="playback" data="ivr/ivr-whisper_stopped.wav"/>
        <action application="uuid_break" data=""/>
      </condition>
    </extension>

    <!-- Join Call - *#1 + extension -->
    <extension name="Join_Call">
      <condition field="destination_number" expression="^\*#1(10[0-9][0-9])$">
        <action application="set" data="join_extension=$1"/>
        <action application="playback" data="ivr/ivr-joining_call.wav"/>
        <action application="uuid_broadcast" data="${join_extension} conference"/>
      </condition>
    </extension>

    <!-- Leave Conference - *#2 -->
    <extension name="Leave_Conference">
      <condition field="destination_number" expression="^\*#2$">
        <action application="playback" data="ivr/ivr-leaving_conference.wav"/>
        <action application="hangup" data="NORMAL_CLEARING"/>
      </condition>
    </extension>

    <!-- Conference Rooms (3000-3099) -->
    <extension name="Conference_Rooms">
      <condition field="destination_number" expression="^(30[0-9][0-9])$">
        <action application="answer"/>
        <action application="conference" data="$1-${domain_name}@default"/>
      </condition>
    </extension>

    <!-- Outbound Call IVR - *95 + number -->
    <extension name="Outbound_IVR_Call">
      <condition field="destination_number" expression="^\*95(.*)$">
        <action application="set" data="outbound_number=$1"/>
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/${outbound_number}"/>
        <action application="answer"/>
        <action application="sleep" data="2000"/>
        <action application="ivr" data="outbound_ivr"/>
      </condition>
    </extension>

    <!-- Outbound Call with Confirmation - *96 + number -->
    <extension name="Outbound_Confirm_IVR_Call">
      <condition field="destination_number" expression="^\*96(.*)$">
        <action application="set" data="outbound_number=$1"/>
        <action application="set" data="effective_caller_id_number=${caller_id_number}"/>
        <action application="set" data="effective_caller_id_name=${caller_id_name}"/>
        <action application="set" data="call_timeout=60"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="sofia/gateway/sip_trunk_provider/${outbound_number}"/>
        <action application="answer"/>
        <action application="sleep" data="2000"/>
        <action application="ivr" data="outbound_confirm_ivr"/>
      </condition>
    </extension>

    <!-- DND Control Features -->
    <!-- Toggle DND - *97 -->
    <extension name="Toggle_DND">
      <condition field="destination_number" expression="^\*97$">
        <action application="set" data="current_dnd=${dnd_status}"/>
        <action application="set" data="new_dnd=${dnd_status=off?on:off}"/>
        <action application="playback" data="ivr/ivr-dnd_${new_dnd}.wav"/>
        <action application="set" data="dnd_status=${new_dnd}"/>
        <action application="hash" data="insert/dnd/${caller_id_number}/${new_dnd}"/>
      </condition>
    </extension>

    <!-- Check DND Status - *98 -->
    <extension name="Check_DND_Status">
      <condition field="destination_number" expression="^\*98$">
        <action application="set" data="current_dnd=${dnd_status}"/>
        <action application="playback" data="ivr/ivr-dnd_status_${current_dnd}.wav"/>
      </condition>
    </extension>

    <!-- Queue Pause/Unpause - *99 -->
    <extension name="Queue_Pause_Unpause">
      <condition field="destination_number" expression="^\*99$">
        <action application="set" data="current_pause=${queue_pause_status}"/>
        <action application="set" data="new_pause=${queue_pause_status=false?true:false}"/>
        <action application="playback" data="ivr/ivr-queue_${new_pause=true?paused:unpaused}.wav"/>
        <action application="set" data="queue_pause_status=${new_pause}"/>
        <action application="hash" data="insert/queue_pause/${caller_id_number}/${new_pause}"/>
      </condition>
    </extension>

    <!-- DND Override for Emergency - *97 + extension -->
    <extension name="DND_Override">
      <condition field="destination_number" expression="^\*97(10[0-9][0-9])$">
        <action application="set" data="override_extension=$1"/>
        <action application="playback" data="ivr/ivr-dnd_override.wav"/>
        <action application="bridge" data="user/${override_extension}@${domain_name}"/>
      </condition>
    </extension>

    <!-- Call Pickup Groups -->
    <!-- Pickup Support Group - *70 -->
    <extension name="Pickup_Support_Group">
      <condition field="destination_number" expression="^\*70$">
        <action application="playback" data="ivr/ivr-pickup_support_group.wav"/>
        <action application="pickup" data="support"/>
      </condition>
    </extension>

    <!-- Pickup Sales Group - *71 -->
    <extension name="Pickup_Sales_Group">
      <condition field="destination_number" expression="^\*71$">
        <action application="playback" data="ivr/ivr-pickup_sales_group.wav"/>
        <action application="pickup" data="sales"/>
      </condition>
    </extension>

    <!-- Pickup All Groups - *72 -->
    <extension name="Pickup_All_Groups">
      <condition field="destination_number" expression="^\*72$">
        <action application="playback" data="ivr/ivr-pickup_all_groups.wav"/>
        <action application="pickup" data="all"/>
      </condition>
    </extension>

    <!-- Group Ringing -->
    <!-- Ring Support Group - 2000 -->
    <extension name="Ring_Support_Group">
      <condition field="destination_number" expression="^2000$">
        <action application="answer"/>
        <action application="set" data="ring_timeout=20"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="user/1000@${domain_name},user/1001@${domain_name},user/1002@${domain_name}"/>
      </condition>
    </extension>

    <!-- Ring Sales Group - 2001 -->
    <extension name="Ring_Sales_Group">
      <condition field="destination_number" expression="^2001$">
        <action application="answer"/>
        <action application="set" data="ring_timeout=20"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="user/1003@${domain_name},user/1004@${domain_name},user/1005@${domain_name}"/>
      </condition>
    </extension>

    <!-- Ring All Groups - 2002 -->
    <extension name="Ring_All_Groups">
      <condition field="destination_number" expression="^2002$">
        <action application="answer"/>
        <action application="set" data="ring_timeout=30"/>
        <action application="set" data="hangup_after_bridge=true"/>
        <action application="set" data="continue_on_fail=true"/>
        <action application="bridge" data="user/1000@${domain_name},user/1001@${domain_name},user/1002@${domain_name},user/1003@${domain_name},user/1004@${domain_name},user/1005@${domain_name}"/>
      </condition>
    </extension>

    <!-- Time-based Routing -->
    <!-- Business Hours Routing -->
    <extension name="Business_Hours_Routing">
      <condition field="destination_number" expression="^5000$">
        <action application="set" data="current_time=${strftime(%H:%M)}"/>
        <action application="set" data="current_day=${strftime(%A)}"/>
        <action application="set" data="current_date=${strftime(%m-%d)}"/>

        <!-- Check if holiday -->
        <action application="set" data="is_holiday=${holiday_check(${current_date})}"/>

        <!-- Check if business hours -->
        <action application="set" data="is_business_hours=${time_check(business_hours)}"/>

        <!-- Route based on time conditions -->
        <action application="answer"/>
        <action application="sleep" data="1000"/>
        <action application="ivr" data="main_ivr"/>
      </condition>
    </extension>

    <!-- After Hours Message -->
    <extension name="After_Hours_Message">
      <condition field="destination_number" expression="^5001$">
        <action application="answer"/>
        <action application="playback" data="ivr/ivr-after_hours_message.wav"/>
        <action application="sleep" data="3000"/>
        <action application="playback" data="ivr/ivr-emergency_contact.wav"/>
        <action application="sleep" data="2000"/>
        <action application="hangup" data="NORMAL_CLEARING"/>
      </condition>
    </extension>

    <!-- Holiday Message -->
    <extension name="Holiday_Message">
      <condition field="destination_number" expression="^5002$">
        <action application="answer"/>
        <action application="playback" data="ivr/ivr-holiday_message.wav"/>
        <action application="sleep" data="3000"/>
        <action application="playback" data="ivr/ivr-emergency_contact.wav"/>
        <action application="sleep" data="2000"/>
        <action application="hangup" data="NORMAL_CLEARING"/>
      </condition>
    </extension>

    <!-- Call Recording Controls -->
    <!-- Start Recording - *1 -->
    <extension name="Start_Recording">
      <condition field="destination_number" expression="^\*1$">
        <action application="set" data="recording_path=/usr/share/freeswitch/sounds/recordings/${strftime(%Y/%m/%d)}/${uniqueid}.mp3"/>
        <action application="set" data="recording_enabled=true"/>
        <action application="record_session" data="${recording_path}"/>
        <action application="playback" data="ivr/ivr-recording_started.wav"/>
      </condition>
    </extension>

    <!-- Stop Recording - *2 -->
    <extension name="Stop_Recording">
      <condition field="destination_number" expression="^\*2$">
        <action application="stop_record_session" data=""/>
        <action application="playback" data="ivr/ivr-recording_stopped.wav"/>
      </condition>
    </extension>

    <!-- Pause Recording - *3 -->
    <extension name="Pause_Recording">
      <condition field="destination_number" expression="^\*3$">
        <action application="pause_record_session" data=""/>
        <action application="playback" data="ivr/ivr-recording_paused.wav"/>
      </condition>
    </extension>

    <!-- Resume Recording - *4 -->
    <extension name="Resume_Recording">
      <condition field="destination_number" expression="^\*4$">
        <action application="resume_record_session" data=""/>
        <action application="playback" data="ivr/ivr-recording_resumed.wav"/>
      </condition>
    </extension>

    <!-- Toggle Recording - *5 -->
    <extension name="Toggle_Recording">
      <condition field="destination_number" expression="^\*5$">
        <action application="set" data="current_recording=${recording_enabled}"/>
        <action application="set" data="new_recording=${recording_enabled=true?false:true}"/>
        <action application="set" data="recording_enabled=${new_recording}"/>
        <action application="playback" data="ivr/ivr-recording_${new_recording=true?started:stopped}.wav"/>
      </condition>
    </extension>

  </context>
</include>